<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converging Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gray-800">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Converging Demo</h1>
                <p class="text-gray-500 mt-2">Ingresa tus credenciales</p>
            </div>
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="login-email">Email</label>
                    <input class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                           id="login-email" type="email" placeholder="tu@email.com" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="login-password">Password</label>
                    <input class="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                           id="login-password" type="password" placeholder="********" required>
                </div>
                <div id="login-error" class="mb-4 p-3 bg-red-100 text-red-700 rounded hidden"></div>
                <button class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                    Ingresar
                </button>
            </form>
        </div>
    </div>

    <!-- App Container (hidden until login) -->
    <div id="app-container" class="hidden">
        <div class="flex h-screen overflow-hidden">
        <!-- Mobile Header -->
        <div class="md:hidden fixed top-0 left-0 right-0 bg-gray-900 text-white z-50">
            <div class="flex items-center justify-between px-4 h-14">
                <span class="font-bold">Converging Demo</span>
                <button onclick="toggleMobileMenu()" class="p-2">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu" class="md:hidden fixed inset-0 z-40 hidden">
            <div class="absolute inset-0 bg-black opacity-50" onclick="toggleMobileMenu()"></div>
            <div class="absolute top-0 left-0 w-64 h-full bg-gray-800 text-white pt-14">
                <nav class="px-2 py-4 space-y-2">
                    <a href="#" onclick="showSection('dashboard'); toggleMobileMenu();" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                        <i class="fas fa-chart-line mr-3"></i> Dashboard
                    </a>
                    <a href="#" onclick="showSection('captura'); toggleMobileMenu();" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                        <i class="fas fa-plus-circle mr-3"></i> Captura Lead
                    </a>
                    <a href="#" onclick="showSection('llamadas'); toggleMobileMenu();" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                        <i class="fas fa-phone-slash mr-3"></i> Llamadas Perdidas
                    </a>
                    <a href="#" onclick="showSection('agente'); toggleMobileMenu();" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                        <i class="fas fa-user-tie mr-3"></i> Vista Agente
                    </a>
                </nav>
                <div class="absolute bottom-0 left-0 right-0 px-4 py-4 border-t border-gray-700">
                    <button onclick="handleLogout()" class="flex items-center w-full px-4 py-2 text-gray-300 hover:bg-red-700 rounded-md">
                        <i class="fas fa-sign-out-alt mr-3"></i> Cerrar Sesion
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar (Desktop) -->
        <div class="hidden md:flex md:flex-shrink-0">
            <div class="flex flex-col w-64 bg-gray-800 text-white">
                <div class="flex items-center justify-center h-16 bg-gray-900 text-xl font-bold">
                    Converging Demo
                </div>
                <div class="flex flex-col flex-1 overflow-y-auto">
                    <nav class="flex-1 px-2 py-4 space-y-2">
                        <a href="#" onclick="showSection('dashboard')" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                            <i class="fas fa-chart-line mr-3"></i> Dashboard
                        </a>
                        <a href="#" onclick="showSection('captura')" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                            <i class="fas fa-plus-circle mr-3"></i> Captura Lead
                        </a>
                        <a href="#" onclick="showSection('llamadas')" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                            <i class="fas fa-phone-slash mr-3"></i> Llamadas Perdidas
                        </a>
                        <a href="#" onclick="showSection('agente')" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md">
                            <i class="fas fa-user-tie mr-3"></i> Vista Agente
                        </a>
                    </nav>
                    <div class="px-4 py-4 border-t border-gray-700">
                        <button onclick="handleLogout()" class="flex items-center w-full px-4 py-2 text-gray-300 hover:bg-red-700 rounded-md">
                            <i class="fas fa-sign-out-alt mr-3"></i> Cerrar Sesion
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col flex-1 w-0 overflow-hidden">
            <main class="flex-1 relative overflow-y-auto focus:outline-none p-6 pt-20 md:pt-6">

                <!-- Dashboard Section -->
                <div id="dashboard-section" class="section-content">
                    <h2 class="text-2xl font-bold mb-4">Dashboard</h2>

                    <!-- KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                            <h3 class="text-gray-500 text-sm">Total Contactos</h3>
                            <p class="text-3xl font-bold" id="kpi-total">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-yellow-500">
                            <h3 class="text-gray-500 text-sm">Nuevos (Hoy)</h3>
                            <p class="text-3xl font-bold" id="kpi-nuevos">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-green-500">
                            <h3 class="text-gray-500 text-sm">Tasa Conversión</h3>
                            <p class="text-3xl font-bold" id="kpi-conversion">0%</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-red-500">
                            <h3 class="text-gray-500 text-sm">Pendientes</h3>
                            <p class="text-3xl font-bold" id="kpi-pendientes">0</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Chart Placeholder 1 -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-bold mb-4">Contactos por Estado</h3>
                            <div id="chart-estado" class="h-64 flex items-center justify-center bg-gray-50 rounded text-gray-400">
                                <!-- Placeholder for chart -->
                                <ul id="list-estado" class="w-full text-left"></ul>
                            </div>
                        </div>
                        <!-- Chart Placeholder 2 -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-bold mb-4">Top Agentes</h3>
                            <div id="chart-agentes" class="h-64 flex items-center justify-center bg-gray-50 rounded text-gray-400">
                                <ul id="list-agentes" class="w-full text-left"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Contacts Table -->
                    <div class="mt-8 bg-white shadow rounded-lg overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="font-bold">Últimos Contactos</h3>
                        </div>
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Teléfono</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Agente</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="table-contacts">
                                <!-- Filas dinámicas -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Captura Section -->
                <div id="captura-section" class="section-content hidden">
                    <h2 class="text-2xl font-bold mb-4">Registrar Nuevo Lead (Gisel)</h2>
                    <div class="bg-white p-8 rounded-lg shadow max-w-2xl mx-auto">
                        <form id="form-captura" onsubmit="registrarContacto(event)">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="nombre">Nombre Completo</label>
                                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombre" type="text" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="telefono">Teléfono</label>
                                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="telefono" type="tel" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="propiedad">Interesado en Propiedad</label>
                                <select class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="propiedad" onchange="toggleAsignacionManual()">
                                    <option value="">-- Sin propiedad especifica --</option>
                                    <!-- Propiedades dinamicas -->
                                </select>
                            </div>
                            <div id="asignacion-container" class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2">Modo de Asignacion</label>
                                <div class="flex space-x-4 mb-2">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="modo_asignacion" value="round_robin" checked onchange="toggleAgenteSelect()" class="form-radio">
                                        <span class="ml-2">Round Robin (automatico)</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="modo_asignacion" value="manual" onchange="toggleAgenteSelect()" class="form-radio">
                                        <span class="ml-2">Asignar manualmente</span>
                                    </label>
                                </div>
                                <select class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline hidden" id="agente-manual">
                                    <option value="">-- Seleccionar Agente --</option>
                                    <!-- Agentes dinamicos -->
                                </select>
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="notas">Notas Iniciales</label>
                                <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="notas" rows="3"></textarea>
                            </div>
                            <div class="flex items-center justify-between">
                                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                                    Registrar Contacto
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Llamadas Perdidas Section -->
                <div id="llamadas-section" class="section-content hidden">
                    <h2 class="text-2xl font-bold mb-4">Llamadas Perdidas (Gisel)</h2>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Simulador de llamada -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-bold mb-4 text-gray-700">Simular Llamada Entrante</h3>
                            <p class="text-sm text-gray-500 mb-4">Genera un numero aleatorio de un cliente existente para simular una llamada perdida.</p>
                            <button onclick="simularLlamada()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg w-full">
                                <i class="fas fa-phone-alt mr-2"></i> Simular Llamada Perdida
                            </button>

                            <div id="llamada-simulada" class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg hidden">
                                <p class="text-sm text-red-600 font-medium">Llamada perdida de:</p>
                                <p class="text-2xl font-bold text-red-700" id="numero-simulado"></p>
                                <button onclick="copiarNumero()" class="mt-2 text-sm text-red-600 hover:text-red-800">
                                    <i class="fas fa-copy mr-1"></i> Copiar numero
                                </button>
                            </div>
                        </div>

                        <!-- Buscador de cliente -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-bold mb-4 text-gray-700">Buscar Cliente por Telefono</h3>
                            <div class="flex space-x-2">
                                <input type="tel" id="telefono-buscar" placeholder="Ingresa el numero..."
                                    class="flex-1 shadow border rounded py-2 px-3 text-gray-700 focus:outline-none focus:shadow-outline">
                                <button onclick="buscarCliente()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>

                            <!-- Resultado de busqueda -->
                            <div id="resultado-busqueda" class="mt-4 hidden">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vista Agente Section -->
                <div id="agente-section" class="section-content hidden">
                    <h2 class="text-2xl font-bold mb-4">Vista de Agente</h2>
                    <div class="mb-4">
                        <label class="mr-2">Simular como Agente:</label>
                        <select id="select-agente-simulacion" onchange="cargarVistaAgente()" class="border rounded p-1">
                            <!-- Agentes dinamicos -->
                        </select>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- WhatsApp Simulado -->
                        <div class="bg-gray-100 rounded-lg shadow-lg overflow-hidden" style="max-height: 600px;">
                            <div class="bg-green-600 text-white px-4 py-3 flex items-center">
                                <i class="fab fa-whatsapp text-2xl mr-3"></i>
                                <div>
                                    <p class="font-bold">Sistema CRM</p>
                                    <p class="text-xs opacity-75">Notificaciones automaticas</p>
                                </div>
                            </div>
                            <div id="whatsapp-chat" class="p-4 overflow-y-auto bg-gray-200" style="height: 500px; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVR4nO3BMQEAAADCoPVPbQwfoAAAAAAAAAAAAOBmBmUAATLjRvAAAAAASUVORK5CYII=');">
                                <!-- Mensajes dinamicos -->
                            </div>
                        </div>

                        <!-- Lista de Leads del Agente -->
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <div class="px-6 py-4 border-b border-gray-200 bg-yellow-50">
                                <h3 class="font-bold text-yellow-800">Mis Leads Pendientes</h3>
                            </div>
                            <ul class="divide-y divide-gray-200" id="list-agente-leads">
                                <!-- Leads asignados -->
                            </ul>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    </div>

    <!-- Modal simple para notificaciones -->
    <div id="notification" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded shadow-lg hidden">
        Mensaje de notificación
    </div>

    <script src="app.js"></script>
</body>
</html>
